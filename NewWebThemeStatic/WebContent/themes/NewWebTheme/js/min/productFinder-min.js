!function($){var e={},t=window.location.protocol+"//"+window.location.host;$.widget("canon.productfinder",{options:{typeaheadButtonLabel:"Select Product",typeaheadHeader:"Use your Model Name / Number",typeaheadPlaceholder:"Enter a Model Name / Number",dropdownHeader:"Use our Product Finder",productFinderButtonLabel:"Product Finder",typeaheadSelectCallback:void 0,context:"",productFinderHierarchyUrl:"",levelLabels:["Product Category","Product Family","Product Series","Models"],levelDepth:4,showImages:!1,initialLevel:0},_create:function(){var e=this.element;e.addClass("row"),e.append($("<div></div>",{"class":"col-xs-12 text-center cf-error",id:"pf-error-message"})),this._createTypeahead(e),e.append($("<div></div>",{"class":"col-xs-12 col-sm-1 text-center"}).append($("<span></span>",{"class":"conjunction"}).text("OR"))),this._createDropdown(e);var t=$("<div></div>",{"class":"row pf-all-selectors"});e.after(t),t.append($("<div></div>",{"class":"col-sm-12 text-right"}).append($("<button></button>",{"class":"cbtn cbtn-canon-red-o pf-clear"}).text("Clear All"))),this._createLevel(t,this.options.initialLevel,this.options.levelLabels[this.options.initialLevel]),this._addOpenProductFinderClickHandler(),this._addCloseButtonHandler(),this._initializeTypeAhead(),this._addLevelClickHandler(),this._addOptionSelectHandler()},_createTypeahead:function(e){var t=this,a=$("<div></div>",{"class":"col-xs-12 col-sm-6 text-center"});a.append("<h4>"+this.options.typeaheadHeader+"</h4>");var n=$("<div></div>",{"class":"input-group"});n.append($("<input></input>",{type:"text",id:"modelName","class":"form-control",placeholder:this.options.typeaheadPlaceholder}).attr("autocomplete","off")),n.keypress(function(e){if(13==e.which){var a=$("#btn-get");void 0!=a.data("model")&&(CoreMetricsWrapper.createElementTag(a.text()+" - "+a.data("model").title,"Open",null),t._trigger("selected",e,a.data("model")),a.removeData("model")),$("#modelName").val("")}}),$(document).on("keydown",$("#modelName"),function(e){if(13!=e.which){var t=$("#btn-get");t.removeData("model")}});var o=$("<div></div>",{id:"btn-get","class":"input-group-addon cbg-dark-gray-1 cbr-dark-gray-1 cf-white"});o.text(this.options.typeaheadButtonLabel),o.click(function(e){e.preventDefault();var a=$(this);void 0!=a.data("model")&&(CoreMetricsWrapper.createElementTag(a.text()+"-"+a.data("model").title+" / "+a.data("model").model_id,document.title+"- MODEL NAME/NUMBER ENTRY",null),t._trigger("selected",e,a.data("model")),a.removeData("model")),$("#modelName").val("")}),o.hover(function(){var e=$(this);void 0!=e.data("model")&&e.addClass("cbtn-canon-red")},function(){$(this).removeClass("cbtn-canon-red")}),n.append(o);var l=$("<div></div>",{"class":"form-group"});l.append(n),a.append(l),e.append(a)},_createDropdown:function(e){var t=$("<div></div>",{"class":"col-xs-12 col-sm-5 text-center"});t.append("<h4>"+this.options.dropdownHeader+"</h4>");var a=$("<div></div>",{"class":"input-group"}),n=$("<div></div>",{"class":"input-group-addon cbg-dark-gray-1 cbr-dark-gray-1 cf-white pf-open",style:"cursor: pointer"});n.attr("data-prf-context",this.options.context),n.append($("<span></span>",{"class":"pf-open-on"})),n.append(this.options.productFinderButtonLabel),a.append(n);var o=$("<div></div>",{"class":"form-group"});o.append(a),t.append(o),e.append(t)},_addOpenProductFinderClickHandler:function(){var t=this;$(".pf-open").click(function(a){a.preventDefault(),$(".pf-open span").toggleClass("pf-open-on pf-open-off"),$(".pf-all-selectors").slideToggle();var n=$(this);if(n.find("span").hasClass("pf-open-off")){var o=n.attr("data-prf-context");$.ajax({url:t.options.productFinderHierarchyUrl,type:"POST",datatype:"json",data:{context:o}}).done(function(a){e=a.sa.items,1===t.options.initialLevel&&(e=a.sa.items[0].children);var n=$.grep(e,function(e,a){return e.depth===t.options.initialLevel.toString()}),o=$("#level"+t.options.initialLevel);o.empty(),$.each(n,function(e,t){o.append($("<li data-depth='"+t.depth+"' data-name='"+t.name+"' title='"+t.title+"'>"+decodeURIComponent(t.title)+"</li>"))})})}})},_addOptionSelectHandler:function(){var a=this;$(document).on("click",".pf-selector ul.pf-options li",function(){var n=$(this);n.closest(".pf-selector").find("small").html(n.text());var o=n.closest("div.pf-level"),l=n.attr("data-depth"),i=n.attr("data-name"),d=Number(l)+1,s=$("div.pf-all-selectors"),r;if($.each(e,function v(e,t){return t.depth===l&&t.name===i?(r=t,!1):void(null!==t&&"object"==typeof t&&$.each(t,v))}),o.nextAll("div.pf-level").remove(),$("button.pf-continue").remove(),r&&r.hasOwnProperty("children")&&r.children.length>0){var c=a._createLevel(s,d,a.options.levelLabels[d]),p=$("#level"+d);p.empty();var u=!1;$.each(r.children,function(e,n){var o=$("<li data-depth='"+n.depth+"' data-name='"+n.name+"' title='"+n.title+"'>"+decodeURIComponent(n.title)+"</li>");n.hasOwnProperty("children")&&0!==n.children.length||(u=!0,o.addClass("col-xs-12 col-md-3 col-sm-4"),a.options.showImages&&($("#devicetype-mobile").is(":visible")?o.prepend('<img src="'+t+n.small_thumbnailImageUrl+'" class="img-responsive" /><br/>'):$("#devicetype-tablet").is(":visible")?o.prepend('<img src="'+t+n.medium_thumbnailImageUrl+'" class="img-responsive" /><br/>'):o.prepend('<img src="'+t+n.large_thumbnailImageUrl+'" class="img-responsive" /><br/>')),c.find("h3").text(a.options.levelLabels[a.options.levelLabels.length-1])),p.append(o),u&&!p.hasClass("products-list")&&p.addClass("products-list")}),c.find(".pf-selector").click()}else 0===$("button.pf-continue").length?(s.append($("<div></div>",{"class":"col-sm-12 text-center"}).append($("<button></button>",{"class":"pf-continue cbtn cbtn-light-gray-1"}).data("model",r).text(a.options.typeaheadButtonLabel))),$("button.pf-continue").click(function(e){e.preventDefault();var t="";$("div.pf-selector small").each(function(){t=t+$(this).text()+">"}),t=t.substring(0,t.length-1),CoreMetricsWrapper.createElementTag($(this).text()+" - "+t+" / "+$(this).data("model").model_id,document.title+"- PRODUCT FINDER",null),a._trigger("selected",e,$(this).data("model")),$(this).removeData("model"),a.closeProductFinder()})):$("button.pf-continue").data("model",r)})},_createLevel:function(e,t,a){var n=$("<div></div>",{"class":"col-sm-12 pf-level",style:"cursor: pointer"}),o=$("<div></div>",{"class":"pf-selector text-center cbr-light-gray-1"});return n.append(o),t===this.options.initialLevel&&n.addClass("first-level"),o.append($("<h3></h3>").text(a)),o.append($("<i></i>",{"class":"fa fa-angle-down pull-right"})),o.append($("<small></small>")),o.append($("<ul></ul>",{"class":"pf-options clearfix",id:"level"+t})),o.click(function(){}),e.append(n),n},_addLevelClickHandler:function(){$(document).on("click",".pf-selector",function(){var e=$(this);e.toggleClass("active"),e.find(".pf-options").fadeToggle(0);var t=e.find("i");t.hasClass("fa-angle-down")?t.removeClass("fa-angle-down").addClass("fa-angle-up"):t.removeClass("fa-angle-up").addClass("fa-angle-down")})},closeProductFinder:function(){$(".pf-open span").removeClass("pf-open-off").addClass("pf-open-on"),$("div.pf-level").not(".first-level").remove(),$("button.pf-continue").remove(),$(".pf-all-selectors").hide(),$(".pf-selector small").text("")},updateButtonLabels:function(e){this.options.typeaheadButtonLabel=e,$("#btn-get").text(e),$("button.pf-continue").length>0&&$("button.pf-continue").text(e)},updateContext:function(e){this.closeProductFinder(),this.options.context=e,$("div.pf-open").attr("data-prf-context",e)},updateLevelLabels:function(e){this.options.levelLabels=e,$("div.first-level").find("h3").text(e[0])},showTypeahead:function(e){e?($("#product-finder").show(),$("button.pf-close").show(),this.closeProductFinder()):($("div.pf-open").click(),$("#product-finder").hide(),$("button.pf-close").hide())},_addCloseButtonHandler:function(){$(".pf-clear").click(function(e){e.preventDefault(),$("div.pf-level").not(".first-level").remove(),$("button.pf-continue").remove(),$(".pf-selector small").text("")})},_initializeTypeAhead:function(){var e=this,t=null,a=700;$("#modelName").typeahead({source:function(n,o){t&&clearTimeout(t),t=setTimeout(function(){return $.post(e.options.productFinderHierarchyUrl,{context:e.options.context},function(e){var t=[];return $.each(e.sa.items,function a(e,n){void 0!==n.title&&""!==n.model_id&&t.push(n),null!==n&&"object"==typeof n&&$.each(n,a)}),o(t)})},a)},displayText:function(e){return $("<div/>").html(e.title).text()},afterSelect:function(e){$("#btn-get").data("model",e)}})}})}(jQuery);