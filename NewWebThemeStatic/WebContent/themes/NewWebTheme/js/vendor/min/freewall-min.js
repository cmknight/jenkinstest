!function($){null==$.isNumeric&&($.isNumeric=function(t){return null!=t&&t.constructor===Number}),null==$.isFunction&&($.isFunction=function(t){return null!=t&&t instanceof Function});var t=$(window),e=$(document),i={defaultConfig:{animate:!1,cache:!0,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,selector:"> div",draggable:!1,rightToLeft:!1,bottomToTop:!1,onGapFound:function(){},onComplete:function(){},onResize:function(){},onBlockReady:function(){},onBlockFinish:function(){},onBlockActive:function(){}},plugin:{},totalGrid:1,transition:!1,loadBlock:function(t,e){var i=e.runtime,n=i.gutterX,a=i.gutterY,l=i.cellH,o=i.cellW,r=null,h=$(t),d=h.data("active"),s=h.attr("data-position"),u=parseInt(h.attr("data-fixSize")),c=i.lastId++ +"-"+i.totalGrid;if(!h.hasClass("fw-float")){h.attr({id:c,"data-delay":t.index}),e.animate&&this.transition&&this.setTransition(t,""),isNaN(u)&&(u=null),null==u&&(u=e.fixSize);var f=1==u?"ceil":"round";null==h.attr("data-height")&&h.attr("data-height",h.height()),null==h.attr("data-width")&&h.attr("data-width",h.width());var g=1*h.attr("data-height"),m=1*h.attr("data-width");e.cache||(t.style.width="",m=h.width(),t.style.height="",g=h.height());var w=m?Math[f]((m+n)/o):0,v=g?Math[f]((g+a)/l):0;if(u||"auto"!=e.cellH||(h.width(o*w-n),t.style.height="",g=h.height(),v=g?Math.round((g+a)/l):0),u||"auto"!=e.cellW||(h.height(l*v-a),t.style.width="",m=h.width(),w=m?Math.round((m+n)/o):0),null!=u&&(w>i.limitCol||v>i.limitRow))r=null;else if(v&&v<i.minHoB&&(i.minHoB=v),w&&w<i.minWoB&&(i.minWoB=w),v>i.maxHoB&&(i.maxHoB=v),w>i.maxWoB&&(i.maxWoB=w),0==m&&(w=0),0==g&&(v=0),r={id:c,width:w,height:v,fixSize:u},s){s=s.split("-"),r.y=1*s[0],r.x=1*s[1],r.width=null!=u?w:Math.min(w,i.limitCol-r.x),r.height=null!=u?v:Math.min(v,i.limitRow-r.y);var p=r.y+"-"+r.x+"-"+r.width+"-"+r.height;d?(i.holes[p]={id:r.id,top:r.y,left:r.x,width:r.width,height:r.height},this.setBlock(r,e)):delete i.holes[p]}return null==h.attr("data-state")?h.attr("data-state","init"):h.attr("data-state","move"),e.onBlockReady.call(t,r,e),s&&d?null:r}},setBlock:function(t,e){var i=e.runtime,n=i.gutterX,a=i.gutterY,l=t.height,o=t.width,r=i.cellH,h=i.cellW,d=t.x,s=t.y;e.rightToLeft&&(d=i.limitCol-d-o),e.bottomToTop&&(s=i.limitRow-s-l);var u={fixSize:t.fixSize,top:s*r,left:d*h,width:h*o-n,height:r*l-a};return u.top=1*u.top.toFixed(2),u.left=1*u.left.toFixed(2),u.width=1*u.width.toFixed(2),u.height=1*u.height.toFixed(2),t.id&&(i.blocks[t.id]=u),u},showBlock:function(t,e){function i(){if(h&&o.attr("data-state","start"),e.animate&&r.transition&&r.setTransition(t,d),l)l.fixSize&&(l.height=1*o.attr("data-height"),l.width=1*o.attr("data-width")),o.css({opacity:1,width:l.width,height:l.height}),o[a]({top:l.top,left:l.left}),null!=o.attr("data-nested")&&r.nestedGrid(t,e);else{var i=parseInt(t.style.height)||0,s=parseInt(t.style.width)||0,u=parseInt(t.style.left)||0,c=parseInt(t.style.top)||0;o[a]({left:u+s/2,top:c+i/2,width:0,height:0,opacity:0})}n.length-=1,e.onBlockFinish.call(t,l,e),0==n.length&&e.onComplete.call(t,l,e)}var n=e.runtime,a=e.animate&&!this.transition?"animate":"css",l=n.blocks[t.id],o=$(t),r=this,h="move"!=o.attr("data-state"),d=h?"width 0.5s, height 0.5s":"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";t.delay&&clearTimeout(t.delay),o.hasClass("fw-float")||(r.setTransition(t,""),t.style.position="absolute",e.onBlockActive.call(t,l,e),e.delay>0?t.delay=setTimeout(i,e.delay*o.attr("data-delay")):i())},nestedGrid:function(t,e){var i,n=$(t),a=e.runtime,l=n.attr("data-gutterX")||e.gutterX,o=n.attr("data-gutterY")||e.gutterY,r=n.attr("data-method")||"fitZone",h=n.attr("data-nested")||"> div",d=n.attr("data-cellH")||e.cellH,s=n.attr("data-cellW")||e.cellW,u=a.blocks[t.id];if(u)switch(i=new freewall(n),i.reset({cellH:d,cellW:s,gutterX:1*l,gutterY:1*o,selector:h}),r){case"fitHeight":i[r](u.height);break;case"fitWidth":i[r](u.width);break;case"fitZone":i[r](u.width,u.height)}},adjustBlock:function(t,e){var i=e.runtime,n=i.gutterX,a=i.gutterY,l=$("#"+t.id),o=i.cellH,r=i.cellW;"auto"==e.cellH&&(l.width(t.width*r-n),l[0].style.height="",t.height=Math.round((l.height()+a)/o))},adjustUnit:function(t,e,i){var n=i.gutterX,a=i.gutterY,l=i.runtime,o=i.cellW,r=i.cellH;if($.isFunction(o)&&(o=o(t)),o=1*o,!$.isNumeric(o)&&(o=1),$.isFunction(r)&&(r=r(e)),r=1*r,!$.isNumeric(r)&&(r=1),$.isNumeric(t)){1>o&&(o*=t);var h=Math.max(1,Math.floor(t/o));$.isNumeric(n)||(n=(t-h*o)/Math.max(1,h-1),n=Math.max(0,n)),h=Math.floor((t+n)/o),l.cellW=(t+n)/Math.max(h,1),l.cellS=l.cellW/o,l.gutterX=n,l.limitCol=h}if($.isNumeric(e)){1>r&&(r*=e);var d=Math.max(1,Math.floor(e/r));$.isNumeric(a)||(a=(e-d*r)/Math.max(1,d-1),a=Math.max(0,a)),d=Math.floor((e+a)/r),l.cellH=(e+a)/Math.max(d,1),l.cellS=l.cellH/r,l.gutterY=a,l.limitRow=d}$.isNumeric(t)||(1>o&&(o=l.cellH),l.cellW=1!=o?o*l.cellS:1,l.gutterX=n,l.limitCol=666666),$.isNumeric(e)||(1>r&&(r=l.cellW),l.cellH=1!=r?r*l.cellS:1,l.gutterY=a,l.limitRow=666666)},resetGrid:function(t){t.blocks={},t.length=0,t.cellH=0,t.cellW=0,t.lastId=1,t.matrix={},t.totalCol=0,t.totalRow=0},setDraggable:function(t,i){var n=!1,a={startX:0,startY:0,top:0,left:0,handle:null,onDrop:function(){},onDrag:function(){},onStart:function(){}};$(t).each(function(){function t(t){return t.stopPropagation(),t=t.originalEvent,t.touches&&(n=!0,t=t.changedTouches[0]),2!=t.button&&3!=t.which&&(r.onStart.call(d,t),r.startX=t.clientX,r.startY=t.clientY,r.top=parseInt(s.css("top"))||0,r.left=parseInt(s.css("left"))||0,e.bind("mouseup touchend",o),e.bind("mousemove touchmove",l)),!1}function l(t){t=t.originalEvent,n&&(t=t.changedTouches[0]),s.css({top:r.top-(r.startY-t.clientY),left:r.left-(r.startX-t.clientX)}),r.onDrag.call(d,t)}function o(t){t=t.originalEvent,n&&(t=t.changedTouches[0]),r.onDrop.call(d,t),e.unbind("mouseup touchend",o),e.unbind("mousemove touchmove",l)}var r=$.extend({},a,i),h=r.handle||this,d=this,s=$(d),u=$(h),c=s.css("position");"absolute"!=c&&s.css("position","relative"),s.find("iframe, form, input, textarea, .ignore-drag").each(function(){$(this).on("touchstart mousedown",function(t){t.stopPropagation()})}),e.unbind("mouseup touchend",o),e.unbind("mousemove touchmove",l),u.unbind("mousedown touchstart").bind("mousedown touchstart",t)})},setTransition:function(t,e){var i=t.style,n=$(t);!this.transition&&n.stop?n.stop():null!=i.webkitTransition?i.webkitTransition=e:null!=i.MozTransition?i.MozTransition=e:null!=i.msTransition?i.msTransition=e:null!=i.OTransition?i.OTransition=e:i.transition=e},getFreeArea:function(t,e,i){for(var n=Math.min(t+i.maxHoB,i.limitRow),a=Math.min(e+i.maxWoB,i.limitCol),l=a,o=n,r=i.matrix,h=t;o>h;++h)for(var d=e;a>d;++d)r[h+"-"+d]&&d>e&&l>d&&(l=d);for(var h=t;n>h;++h)for(var d=e;l>d;++d)r[h+"-"+d]&&h>t&&o>h&&(o=h);return{top:t,left:e,width:l-e,height:o-t}},setWallSize:function(t,e){var i=t.totalRow,n=t.totalCol,a=t.gutterY,l=t.gutterX,o=t.cellH,r=t.cellW,h=Math.max(0,r*n-l),d=Math.max(0,o*i-a);e.attr({"data-total-col":n,"data-total-row":i,"data-wall-width":Math.ceil(h),"data-wall-height":Math.ceil(d)}),t.limitCol<t.limitRow&&!e.attr("data-height")&&e.height(Math.ceil(d))}},n={giot:function(t,e){function n(t,e,i,n,a){for(var l=e;e+a>l;){for(var o=i;i+n>o;)g[l+"-"+o]=t,++o>d&&(d=o);++l>s&&(s=l)}}var a=e.runtime,l=a.limitRow,o=a.limitCol,r=0,h=0,d=a.totalCol,s=a.totalRow,u={},c=a.holes,f=null,g=a.matrix,m=Math.max(o,l),w=null,v=null,p=l>o?1:0,x=null,M=Math.min(o,l);for(var b in c)c.hasOwnProperty(b)&&n(c[b].id||!0,c[b].top,c[b].left,c[b].width,c[b].height);for(var y=0;m>y&&t.length;++y){p?h=y:r=y,x=null;for(var B=0;M>B&&t.length;++B)if(p?r=B:h=B,!a.matrix[h+"-"+r]){w=i.getFreeArea(h,r,a),f=null;for(var b=0;b<t.length;++b)if(!(t[b].height>w.height||t[b].width>w.width)){f=t.splice(b,1)[0];break}if(null==f&&null==e.fixSize){if(x&&!p&&a.minHoB>w.height){x.height+=w.height,n(x.id,x.y,x.x,x.width,x.height),i.setBlock(x,e);continue}if(x&&p&&a.minWoB>w.width){x.width+=w.width,n(x.id,x.y,x.x,x.width,x.height),i.setBlock(x,e);continue}for(var b=0;b<t.length;++b)if(null==t[b].fixSize){f=t.splice(b,1)[0],p?(f.width=w.width,"auto"==e.cellH&&i.adjustBlock(f,e),f.height=Math.min(f.height,w.height)):(f.height=w.height,f.width=Math.min(f.width,w.width));break}}if(null!=f)u[f.id]={id:f.id,x:r,y:h,width:f.width,height:f.height,fixSize:f.fixSize},x=u[f.id],n(x.id,x.y,x.x,x.width,x.height),i.setBlock(x,e);else{var v={x:r,y:h,fixSize:0};if(p){v.width=w.width,v.height=0;for(var k=r-1,H=h;g[H+"-"+k];)g[H+"-"+r]=!0,v.height+=1,H+=1}else{v.height=w.height,v.width=0;for(var H=h-1,k=r;g[H+"-"+k];)g[h+"-"+k]=!0,v.width+=1,k+=1}e.onGapFound(i.setBlock(v,e),e)}}}a.matrix=g,a.totalRow=s,a.totalCol=d}};window.freewall=function(e){function a(t){var e=d.gutterX,n=d.gutterY,a=d.cellH,l=d.cellW,o=$(t),s=o.find(o.attr("data-handle"));i.setDraggable(t,{handle:s[0],onStart:function(t){h.animate&&i.transition&&i.setTransition(this,""),o.css("z-index",9999).addClass("fw-float")},onDrag:function(t,e){var i=o.position(),n=Math.round(i.top/a),h=Math.round(i.left/l),s=Math.round(o.width()/l),u=Math.round(o.height()/a);n=Math.min(Math.max(0,n),d.limitRow-u),h=Math.min(Math.max(0,h),d.limitCol-s),r.setHoles({top:n,left:h,width:s,height:u}),r.refresh()},onDrop:function(){var t=o.position(),e=Math.round(t.top/a),i=Math.round(t.left/l),n=Math.round(o.width()/l),h=Math.round(o.height()/a);e=Math.min(Math.max(0,e),d.limitRow-h),i=Math.min(Math.max(0,i),d.limitCol-n),o.removeClass("fw-float"),o.css({zIndex:"auto",top:e*a,left:i*l});var s,u,c,f;for(u=0;h>u;++u)for(s=0;n>s;++s)c=u+e+"-"+(s+i),f=d.matrix[c],f&&1!=f&&$("#"+f).removeAttr("data-position");d.holes={},o.attr({"data-width":o.width(),"data-height":o.height(),"data-position":e+"-"+i}),r.refresh()}})}var l=$(e);"static"==l.css("position")&&l.css("position","relative");var o=Number.MAX_VALUE,r=this;i.totalGrid+=1;var h=$.extend({},i.defaultConfig),d={blocks:{},events:{},matrix:{},holes:{},cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:o,minHoB:o,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,currentMethod:null,currentArguments:[]};h.runtime=d,d.totalGrid=i.totalGrid;var s=document.body.style;i.transition||(null!=s.webkitTransition||null!=s.MozTransition||null!=s.msTransition||null!=s.OTransition||null!=s.transition)&&(i.transition=!0),$.extend(r,{addCustomEvent:function(t,e){var i=d.events;return t=t.toLowerCase(),!i[t]&&(i[t]=[]),e.eid=i[t].length,i[t].push(e),this},appendBlock:function(t){var e=$(t).appendTo(l),o=null,r=[];d.currentMethod&&(e.each(function(t,e){e.index=++t,(o=i.loadBlock(e,h))&&r.push(o)}),n[h.engine](r,h),i.setWallSize(d,l),d.length=e.length,e.each(function(t,e){i.showBlock(e,h),(h.draggable||e.getAttribute("data-draggable"))&&a(e)}))},appendHoles:function(t){var e=[].concat(t),i={},n;for(n=0;n<e.length;++n)i=e[n],d.holes[i.top+"-"+i.left+"-"+i.width+"-"+i.height]=i;return this},container:l,destroy:function(){var t=l.find(h.selector).removeAttr("id"),e=null,i=[];t.each(function(t,e){$item=$(e);var i=1*$item.attr("data-width")||"",n=1*$item.attr("data-height")||"";$item.width(i).height(n).css({position:"static"})})},fillHoles:function(t){if(0==arguments.length)d.holes={};else{var e=[].concat(t),i={},n;for(n=0;n<e.length;++n)i=e[n],delete d.holes[i.top+"-"+i.left+"-"+i.width+"-"+i.height]}return this},filter:function(t){return d.filter=t,d.currentMethod&&this.refresh(),this},fireEvent:function(t,e,i){var n=d.events;if(t=t.toLowerCase(),n[t]&&n[t].length)for(var a=0;a<n[t].length;++a)n[t][a].call(this,e,i);return this},fitHeight:function(e){var o=l.find(h.selector).removeAttr("id"),s=null,u=[];e=e?e:l.height()||t.height(),d.currentMethod=arguments.callee,d.currentArguments=arguments,i.resetGrid(d),i.adjustUnit("auto",e,h),d.filter?(o.data("active",0),o.filter(d.filter).data("active",1)):o.data("active",1),o.each(function(t,e){var n=$(e);e.index=++t,(s=i.loadBlock(e,h))&&n.data("active")&&u.push(s)}),r.fireEvent("onGridReady",l,h),n[h.engine](u,h),i.setWallSize(d,l),r.fireEvent("onGridArrange",l,h),d.length=o.length,o.each(function(t,e){i.showBlock(e,h),(h.draggable||e.getAttribute("data-draggable"))&&a(e)})},fitWidth:function(e){var o=l.find(h.selector).removeAttr("id"),s=null,u=[];e=e?e:l.width()||t.width(),d.currentMethod=arguments.callee,d.currentArguments=arguments,i.resetGrid(d),i.adjustUnit(e,"auto",h),d.filter?(o.data("active",0),o.filter(d.filter).data("active",1)):o.data("active",1),o.each(function(t,e){var n=$(e);e.index=++t,(s=i.loadBlock(e,h))&&n.data("active")&&u.push(s)}),r.fireEvent("onGridReady",l,h),n[h.engine](u,h),i.setWallSize(d,l),r.fireEvent("onGridArrange",l,h),d.length=o.length,o.each(function(t,e){i.showBlock(e,h),(h.draggable||e.getAttribute("data-draggable"))&&a(e)})},fitZone:function(e,o){var s=l.find(h.selector).removeAttr("id"),u=null,c=[];o=o?o:l.height()||t.height(),e=e?e:l.width()||t.width(),d.currentMethod=arguments.callee,d.currentArguments=arguments,i.resetGrid(d),i.adjustUnit(e,o,h),d.filter?(s.data("active",0),s.filter(d.filter).data("active",1)):s.data("active",1),s.each(function(t,e){var n=$(e);e.index=++t,(u=i.loadBlock(e,h))&&n.data("active")&&c.push(u)}),r.fireEvent("onGridReady",l,h),n[h.engine](c,h),i.setWallSize(d,l),r.fireEvent("onGridArrange",l,h),d.length=s.length,s.each(function(t,e){i.showBlock(e,h),(h.draggable||e.getAttribute("data-draggable"))&&a(e)})},fixPos:function(t){return $(t.block).attr({"data-position":t.top+"-"+t.left}),this},fixSize:function(t){return null!=t.height&&$(t.block).attr({"data-height":t.height}),null!=t.width&&$(t.block).attr({"data-width":t.width}),this},prepend:function(t){return l.prepend(t),d.currentMethod&&this.refresh(),this},refresh:function(){var t=arguments.length?arguments:d.currentArguments;return null==d.currentMethod&&(d.currentMethod=this.fitWidth),d.currentMethod.apply(this,Array.prototype.slice.call(t,0)),this},reset:function(t){return $.extend(h,t),this},setHoles:function(t){var e=[].concat(t),i={},n;for(d.holes={},n=0;n<e.length;++n)i=e[n],d.holes[i.top+"-"+i.left+"-"+i.width+"-"+i.height]=i;return this},unFilter:function(){return delete d.filter,this.refresh(),this}}),l.attr("data-min-width",80*Math.floor(t.width()/80));for(var u in i.plugin)i.plugin.hasOwnProperty(u)&&i.plugin[u].call(r,h,l);t.resize(function(){d.running||(d.running=1,setTimeout(function(){d.running=0,h.onResize.call(r,l)},122),l.attr("data-min-width",80*Math.floor(t.width()/80)))})},freewall.addConfig=function(t){$.extend(i.defaultConfig,t)},freewall.createEngine=function(t){$.extend(n,t)},freewall.createPlugin=function(t){$.extend(i.plugin,t)},freewall.getMethod=function(t){return i[t]}}(window.Zepto||window.jQuery);